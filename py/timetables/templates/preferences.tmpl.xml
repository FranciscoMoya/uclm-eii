<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE offerings PUBLIC "-//UniTime//DTD University Course Timetabling/EN" "https://www.unitime.org/interface/Preferences.dtd">

{% set profes = data['profes'] %}
{% set cursos = data['cursos'] %}
{% set curricula = data['curricula'] %}

<preferences campus="UCLM" term="{{term}}" year="2019" dateFormat="yyyy/M/d" timeFormat="HHmm" created="Wed Mar 08 08:56:15 CET 2017">

    <department code="Acad">
    <!-- Probemos sin same students, solo el curriculum debería bastar
    {% for curr in curricula %}
        {% for year in curr['años'] %}
        <distributionPref type="SAME_STUDENTS" structure="AllClasses" level="R">
            {% for c in year %}
            <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec"/>
            <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" suffix="a"/>
            <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" suffix="b"/>
            <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lab"/>
            {% endfor %}
        </distributionPref>
        {% endfor %}
    {% endfor %}
    -->
    {% for curr in curricula %}
        {% for year in curr['años'] %}
        <distributionPref type="BTB" structure="AllClasses" level="-2">
            {% for c in year %}
            <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec"/>
            <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" suffix="a"/>
            <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" suffix="b"/>
            <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lab"/>
            {% endfor %}
        </distributionPref>
        {% endfor %}
    {% endfor %}

    {% for curr in curricula %}
        {% for year in curr['años'] %}
            {% for c in year %}
        <distributionPref type="SAME_DAYS" structure="AllClasses" level="P">
            <class subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" suffix="1"/>
            <class subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" suffix="1a"/>
            <class subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" suffix="1b"/>
        </distributionPref>
            {% endfor %}
        {% endfor %}
    {% endfor %}

    </department>

    {% for p in profes %}
    <instructor externalId="{{ p['userid'] }}" firstName="{{ p['givenName'] }}" lastName="{{ p['sn'] }}" department="Acad">
        <timePref level="-2">
        {% for day,d in zip('MTWRF',p['desideratum']) %}
            {% for lev,start in zip(d[1:],(830,930,1030,1130,1230,1330,1430,1530,1630,1730,1830,1930)) %}
            <pref level="{{ p['level'](lev) }}" day="{{day}}" start="{{start}}" stop="{{start + 100}}"/>
            {% endfor %}
        {% endfor %}
        </timePref>
    </instructor>
    {% endfor %}

    {% for c in cursos %}
    <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" pattern="Semestre completo">
        <groupPref group="classroom" level="R"/>
        <timePref pattern="1x50 comida 1430" level="R"/>
    </subpart>
    <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" suffix="a" pattern="Semestre completo">
        <groupPref group="classroom" level="R"/>
        <timePref pattern="1x50 comida 1430" level="R"/>
    </subpart>
    <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lec" suffix="b" pattern="Semestre completo">
        <groupPref group="classroom" level="R"/>
        <timePref pattern="1x50 comida 1430" level="R"/>
    </subpart>
    <subpart subject="{{c['subject']}}" course="{{c['nr']}}" type="Lab" pattern="Semanas impares">
        <groupPref group="lab {{c['subject']}}" level="R"/>
        <timePref pattern="1x100 comida 1430" level="R"/>
    </subpart>
    <class subject="{{c['subject']}}" course="{{c['nr']}}" type="Lab" suffix="2" pattern="Semanas pares"/>
    {% endfor %}

</preferences>
