{% extends "base.html" %}
{% set active_sec = 'Desiderata' %}
{% block head %}
    <link rel="stylesheet" type="text/css" href="/static/desiderata.css">
    {% if not auth %}
        <meta http-equiv="refresh" content="0; URL=/">
    {% endif %}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}
{% block content %}

    {% if auth %}

    <h1>Desiderata de horarios para {{aa.givenName}} {{aa.sn}}</h1>

    <div class="text-danger" id="errors"></div>
    <div class="table-responsive-xl">
        <table class="table table-bordered table-dark table-sm">
            <thead class="headings">
                <tr height="45">
                    <th>
                        <div id="pending" class="spinner-border" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </th>
                    {% for h in range(8,20) %}
                    <th scope="col" class="text-center">{{h}}:30</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody class="timetable"></tbody>

            <caption>
                {% for v, lbl in (('p3','Seguro que sí'), 
                                  ('p1','Mejor sí'), 
                                  ('zr','Indiferente'), 
                                  ('m1','Mejor no'), 
                                  ('m3','Seguro que no')) %}
                <div class="form-check form-check-inline">
                    <input type="radio" name="demo" value="{{v}}" id="radio-{{v}}" class="form-radio {{v}}" {{'checked' if v=='zr' else None}}>
                    <label for="radio-{{v}}" class="form-check-label">{{lbl}}</label>
                </div>
                {% endfor %}
            </caption>
        </table>

        <details>
            <summary>Rellenar de acuerdo a las normas generales</summary>
            <ul>
                <li> Normalmente las casillas deberán estar en blanco (<em>Indiferente</em>).</li>
                <li> Rellena en naranja (<em>Mejor no</em>) las horas en las que se prefiere no tener clases, por cualquier motivo.</li>
                <li> Rellena en verde claro (<em>Mejor sí</em>) las horas en las que se prefiere tener clase.</li>
                <li> Las casillas rojas (<em>Seguro que no</em>) indican las horas donde no se puede tener clase, <b>por un motivo justificado</b>.</li>
                <li> Las casillas verde oscuro (<em>Seguro que sí</em>) indican las horas en las que necesariamente se debe tener clase, <b>por un motivo justificado</b>.</li>
                <li> <mark>No se garantiza el cumplimiento de ninguna desiderata</mark> que no esté debidamente justificada.</li>
            </ul>
        </details>
    </div>

    <div id="evidenceUI" style="display:none;">

        <h2 class="mt-5">Justificantes</h2>
        <p> Hay horas marcadas con verde oscuro (<em>seguro que sí</em>) o rojo (<em>seguro que no</em>).  
            Para respetar estas desiderata es necesario aportar justificantes.
        </p>
        <form id="justificanteForm" action="javascript:;" method="POST" enctype="multipart/form-data" onsubmit="postJustificantesForUser('francisco.moya', this)">
            <input type="hidden" id="userid" value="{{aa.uid}}">
            <div class="form-row form-inline">
                    <input class="form-control" id="justificante" name="justificante" type="file" required>
                    <input class="btn btn-primary" id="submit" name="submit" type="submit" value="Añadir">
            </div>
        </form>
        <table class="table table-hover mt-4">
            <thead><tr><th>Justificante</th><th>Fecha</th><th></th></tr></thead>
            <tbody id="justificantesTab"></tbody>
        </table>
        
    </div>

    <script src="/static/desiderata.js"></script>
    <script>
    getDesiderataForUser('{{aa.uid}}');
    getJustificantesForUser('{{aa.uid}}');
    setInterval(updateDesiderataForUser('{{aa.uid}}'), 1000);
    </script>

    {% endif %}

{% endblock %}
