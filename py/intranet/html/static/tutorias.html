<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>UCLM - EII Toledo - Tutorías</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" media="screen" href="/static/tutorias.css">
    </head>
    <body>

        <img style="margin-right:1cm" src="http://blog.uclm.es/identidadvisualcorporativa/files/2015/05/UCLM_todo_Color.png">
        <img src="EII.png" height="100">
        
        <h1>Escuela de Ingeniería Industrial de Toledo</h1>
        <h2>Horarios de tutoría y datos de contacto</h2>
        <div class="content" id="content"></div>

<script>
    SERVICE_ENDPOINT = 'http://intranet.eii-to.uclm.es/v1/';
    function displayCards(div, data) {
        for (k in data) {
            pdata = data[k];
            pdata['id'] = k;
            displayCard(div, pdata);
        }
    }
    labels = ['title', 'office', 'mail', 'department', 'telephoneNumber', 'tutorias'];
    function displayCard(parent, data) {
        var div = document.createElement('div');
        div.setAttribute('class', 'professor');
        div.setAttribute('id', 'professor_' + data['id']);
        var title = document.createElement('button');
        title.setAttribute('class', 'accordion name');
        title.innerHTML = data['sn'] + ', ' + data['givenName'];
        div.appendChild(title);
        var card = document.createElement('div');
        card.setAttribute('class', 'card');
        for (k in labels) {
            card.appendChild(createLabelledItem(labels[k], data['id'], data[labels[k]]));
        }
        div.appendChild(card);
        parent.appendChild(div);
    }
    function createLabelledItem(key, id, value) {
        var div = document.createElement('div');
        div.setAttribute('class', 'item');
        var label = document.createElement('label');
        label.setAttribute('for', key + '_' + id);
        label.innerText = labelText(key);
        div.appendChild(label);
        var v = document.createElement('div');
        v.setAttribute('class', 'value');
        v.setAttribute('id', key + '_' + id);
        v.innerHTML = value;
        div.appendChild(v);
        return div;
    }
    function labelText(key) {
        return {
            'title':'Categoría',
            'office':'Despacho',
            'telephoneNumber':'Teléfono',
            'mail':'Correo-e',
            'department': 'Departamento',
            'tutorias': 'Horario de tutorías'
        }[key];
    }
    function fillData(profes, query, label) {
        var req = new XMLHttpRequest();
        req.onload  = function() {
            data = JSON.parse(req.responseText);
            for (i in profes) {
                var e = document.getElementById(label + '_' + i);
                var id = profes[i]['mail'].split('@')[0].toLowerCase();
                if (e)
                    e.innerHTML = data[id];
            }
        };
        req.open('GET', SERVICE_ENDPOINT + query, true);
        req.send();
    }
    var req = new XMLHttpRequest();
    req.onload  = function() {
        var profes = JSON.parse(req.responseText);
        displayCards(document.querySelector("#content"), profes)
        fillData(profes, 'tutorias', 'tutorias');
        fillData(profes, 'despachos', 'office');
    };
    req.open('GET', SERVICE_ENDPOINT + 'profesores/', true);
    req.send();
</script>    

</body>
</html>